<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>posnk kernel: kernel/streams.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">posnk kernel
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="https://github.com/peterbjornx/posnk"><span>GitHub&#160;Project</span></a></li>
      <li><a href="downloads.html"><span>Downloads</span></a></li>
      <li><a href="features.html"><span>Features</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('streams_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">streams.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements the UNIX file API ( fd streams )  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="syscall_8h_source.html">kernel/syscall.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="streams_8h_source.html">kernel/streams.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="scheduler_8h_source.html">kernel/scheduler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vfs_8h_source.html">kernel/vfs.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="heapmm_8h_source.html">kernel/heapmm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pipe_8h_source.html">kernel/pipe.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="permissions_8h_source.html">kernel/permissions.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="device_8h_source.html">kernel/device.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="process_8h_source.html">kernel/process.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="signals_8h_source.html">kernel/signals.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="stat_8h_source.html">sys/stat.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="types_8h_source.html">sys/types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="errno_8h_source.html">sys/errno.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="fcntl_8h_source.html">fcntl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="unistd_8h_source.html">unistd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br/>
</div>
<p><a href="streams_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeeee7624410f1f022ad880a74489c6b8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#aeeee7624410f1f022ad880a74489c6b8">stream_ptr_search_iterator</a> (<a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *node, void *param)</td></tr>
<tr class="memdesc:aeeee7624410f1f022ad880a74489c6b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterator to test if stream pointer matches the fd.  <a href="#aeeee7624410f1f022ad880a74489c6b8"></a><br/></td></tr>
<tr class="memitem:gaf7737838e38167fe9a767f8e232b4fd7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__stream.html#ga00b145c81011f4c4048f717a61aa6cc1">stream_ptr_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gaf7737838e38167fe9a767f8e232b4fd7">stream_get_ptr</a> (int fd)</td></tr>
<tr class="memdesc:gaf7737838e38167fe9a767f8e232b4fd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the stream pointer object for a file number.  <a href="group__stream.html#gaf7737838e38167fe9a767f8e232b4fd7"></a><br/></td></tr>
<tr class="memitem:a3d159f64d97eb54699c85af7255727ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__stream.html#ga00b145c81011f4c4048f717a61aa6cc1">stream_ptr_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#a3d159f64d97eb54699c85af7255727ca">stream_get_ptr_o</a> (<a class="el" href="process_8h.html#aba6f35930ecff1efae67096dfaa95185">process_info_t</a> *process, int fd)</td></tr>
<tr class="memdesc:a3d159f64d97eb54699c85af7255727ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the stream pointer object for a file number on a different process.  <a href="#a3d159f64d97eb54699c85af7255727ca"></a><br/></td></tr>
<tr class="memitem:aa3106e5fbaa22fcc1be4d34082210937"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#aa3106e5fbaa22fcc1be4d34082210937">stream_ptr_copy_iterator</a> (<a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *node, void *param)</td></tr>
<tr class="memdesc:aa3106e5fbaa22fcc1be4d34082210937"><td class="mdescLeft">&#160;</td><td class="mdescRight">Linked list iterator that copies a process's open fds.  <a href="#aa3106e5fbaa22fcc1be4d34082210937"></a><br/></td></tr>
<tr class="memitem:ga93aae19238feb7665dd30c2dccf2e8ba"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga93aae19238feb7665dd30c2dccf2e8ba">stream_copy_fd_table</a> (<a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *target)</td></tr>
<tr class="memdesc:ga93aae19238feb7665dd30c2dccf2e8ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the current process's stream ptr table to target.  <a href="group__stream.html#ga93aae19238feb7665dd30c2dccf2e8ba"></a><br/></td></tr>
<tr class="memitem:ab264f86ce9b3c8adb5eb3ec55b4e643d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#ab264f86ce9b3c8adb5eb3ec55b4e643d">stream_exec_iterator</a> (<a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *node, void *param)</td></tr>
<tr class="memdesc:ab264f86ce9b3c8adb5eb3ec55b4e643d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Linked list iterator that finds stream ptrs that are to be closed on execution of a new image.  <a href="#ab264f86ce9b3c8adb5eb3ec55b4e643d"></a><br/></td></tr>
<tr class="memitem:gaa17c760186bd4ebee3bd6bc632279154"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gaa17c760186bd4ebee3bd6bc632279154">stream_do_close_on_exec</a> ()</td></tr>
<tr class="memdesc:gaa17c760186bd4ebee3bd6bc632279154"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close the stream ptrs that are to be closed on execute.  <a href="group__stream.html#gaa17c760186bd4ebee3bd6bc632279154"></a><br/></td></tr>
<tr class="memitem:a7f7163659cc3ed18fb77ba36481fd6c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#a7f7163659cc3ed18fb77ba36481fd6c5">stream_closeall_iterator</a> (<a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *node, void *param)</td></tr>
<tr class="memdesc:a7f7163659cc3ed18fb77ba36481fd6c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterator that will select all closeable stream pointers.  <a href="#a7f7163659cc3ed18fb77ba36481fd6c5"></a><br/></td></tr>
<tr class="memitem:gab0711d48a143596389ab19b99fbcd3b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gab0711d48a143596389ab19b99fbcd3b3">stream_do_close_all</a> (<a class="el" href="process_8h.html#aba6f35930ecff1efae67096dfaa95185">process_info_t</a> *process)</td></tr>
<tr class="memdesc:gab0711d48a143596389ab19b99fbcd3b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close all stream pointers for a process.  <a href="group__stream.html#gab0711d48a143596389ab19b99fbcd3b3"></a><br/></td></tr>
<tr class="memitem:a2d55d32570fd809c62d13ab0085f5dca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#a2d55d32570fd809c62d13ab0085f5dca">stream_alloc_fd</a> ()</td></tr>
<tr class="memdesc:a2d55d32570fd809c62d13ab0085f5dca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a new fd handle.  <a href="#a2d55d32570fd809c62d13ab0085f5dca"></a><br/></td></tr>
<tr class="memitem:a8869ae2b9e5f982d0aecd90bd391fb8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#a8869ae2b9e5f982d0aecd90bd391fb8f">stream_claim_fd</a> (int fd)</td></tr>
<tr class="memdesc:a8869ae2b9e5f982d0aecd90bd391fb8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Claim a fd handle.  <a href="#a8869ae2b9e5f982d0aecd90bd391fb8f"></a><br/></td></tr>
<tr class="memitem:ab6cba25b02baab322694c3f22c1a6f9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#ab6cba25b02baab322694c3f22c1a6f9f">stream_free_fd</a> (int fd)</td></tr>
<tr class="memdesc:ab6cba25b02baab322694c3f22c1a6f9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a fd handles.  <a href="#ab6cba25b02baab322694c3f22c1a6f9f"></a><br/></td></tr>
<tr class="memitem:gafa8fdc21fe4e1a47a3be2c913d080808"><td class="memItemLeft" align="right" valign="top"><a class="el" href="glib_8h.html#a9da80127e4eb344e6a9d51f30e992b1a">ssize_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gafa8fdc21fe4e1a47a3be2c913d080808">_sys_getdents</a> (int fd, void *buffer, <a class="el" href="types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> count)</td></tr>
<tr class="memdesc:gafa8fdc21fe4e1a47a3be2c913d080808"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get directory entries.  <a href="group__stream.html#gafa8fdc21fe4e1a47a3be2c913d080808"></a><br/></td></tr>
<tr class="memitem:gac8134168213829dab4254391fe4a548f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="glib_8h.html#a9da80127e4eb344e6a9d51f30e992b1a">ssize_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gac8134168213829dab4254391fe4a548f">_sys_read</a> (int fd, void *buffer, <a class="el" href="types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> count)</td></tr>
<tr class="memdesc:gac8134168213829dab4254391fe4a548f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read from a stream.  <a href="group__stream.html#gac8134168213829dab4254391fe4a548f"></a><br/></td></tr>
<tr class="memitem:ga3f81816bbc345cfe6320c92a67e48627"><td class="memItemLeft" align="right" valign="top"><a class="el" href="glib_8h.html#a9da80127e4eb344e6a9d51f30e992b1a">ssize_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga3f81816bbc345cfe6320c92a67e48627">_sys_write</a> (int fd, void *buffer, <a class="el" href="types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> count)</td></tr>
<tr class="memdesc:ga3f81816bbc345cfe6320c92a67e48627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write to a stream.  <a href="group__stream.html#ga3f81816bbc345cfe6320c92a67e48627"></a><br/></td></tr>
<tr class="memitem:acd4a9d7be01e07112dcec50116bcc482"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="streams_8c.html#acd4a9d7be01e07112dcec50116bcc482">_sys_ftruncate</a> (int fd, <a class="el" href="types_8h.html#af83497edef361523a95b06deda0b4c2d">off_t</a> size)</td></tr>
<tr class="memdesc:acd4a9d7be01e07112dcec50116bcc482"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resize a file.  <a href="#acd4a9d7be01e07112dcec50116bcc482"></a><br/></td></tr>
<tr class="memitem:ga964f6b4cf457ce4fe771d7a4367f0585"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af83497edef361523a95b06deda0b4c2d">off_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga964f6b4cf457ce4fe771d7a4367f0585">_sys_lseek</a> (int fd, <a class="el" href="types_8h.html#af83497edef361523a95b06deda0b4c2d">off_t</a> offset, int whence)</td></tr>
<tr class="memdesc:ga964f6b4cf457ce4fe771d7a4367f0585"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reposition read/write file offset.  <a href="group__stream.html#ga964f6b4cf457ce4fe771d7a4367f0585"></a><br/></td></tr>
<tr class="memitem:ga769dcca95c6f80cd662fc28f0d581aef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga769dcca95c6f80cd662fc28f0d581aef">_sys_fchdir</a> (int fd)</td></tr>
<tr class="memdesc:ga769dcca95c6f80cd662fc28f0d581aef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the working directory for this process to the dir pointed to by <em>fd</em>  <a href="group__stream.html#ga769dcca95c6f80cd662fc28f0d581aef"></a><br/></td></tr>
<tr class="memitem:ga3389d4f570b9ecdd4950666bc4f607fb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga3389d4f570b9ecdd4950666bc4f607fb">_sys_fstat</a> (int fd, struct <a class="el" href="structstat.html">stat</a> *<a class="el" href="kdbg_8c.html#a7d55ba6a8fa98e9c0ae7a04f202b67d7">buf</a>)</td></tr>
<tr class="memdesc:ga3389d4f570b9ecdd4950666bc4f607fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get file status.  <a href="group__stream.html#ga3389d4f570b9ecdd4950666bc4f607fb"></a><br/></td></tr>
<tr class="memitem:ga7ebd0ed5350ccd5ebcd88abc74ab14dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga7ebd0ed5350ccd5ebcd88abc74ab14dd">_sys_fchmod</a> (int fd, <a class="el" href="types_8h.html#a161c505f18322d8ce974064784be272a">mode_t</a> mode)</td></tr>
<tr class="memdesc:ga7ebd0ed5350ccd5ebcd88abc74ab14dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change file mode.  <a href="group__stream.html#ga7ebd0ed5350ccd5ebcd88abc74ab14dd"></a><br/></td></tr>
<tr class="memitem:ga9e340ed6aa36497a4150f75b9c0c193f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga9e340ed6aa36497a4150f75b9c0c193f">_sys_fchown</a> (int fd, <a class="el" href="types_8h.html#a75bb141dc55bc89a8ddc565fd374e3d9">uid_t</a> owner, <a class="el" href="types_8h.html#a3a7834be1a79bb0c5a65d3546c2e3bd8">gid_t</a> group)</td></tr>
<tr class="memdesc:ga9e340ed6aa36497a4150f75b9c0c193f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change file owner and group.  <a href="group__stream.html#ga9e340ed6aa36497a4150f75b9c0c193f"></a><br/></td></tr>
<tr class="memitem:ga0349abb01604f6c3a69996aa8905e186"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga0349abb01604f6c3a69996aa8905e186">_sys_fcntl</a> (int fd, int cmd, int arg)</td></tr>
<tr class="memdesc:ga0349abb01604f6c3a69996aa8905e186"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manipulate stream pointer.  <a href="group__stream.html#ga0349abb01604f6c3a69996aa8905e186"></a><br/></td></tr>
<tr class="memitem:ga7f7816d947b6e32d723c90a8de5e111d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga7f7816d947b6e32d723c90a8de5e111d">_sys_ioctl</a> (int fd, int cmd, int arg)</td></tr>
<tr class="memdesc:ga7f7816d947b6e32d723c90a8de5e111d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control device.  <a href="group__stream.html#ga7f7816d947b6e32d723c90a8de5e111d"></a><br/></td></tr>
<tr class="memitem:ga1bc4122ebd851bb3ecdaf46f34fb2566"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga1bc4122ebd851bb3ecdaf46f34fb2566">_sys_dup2</a> (int oldfd, int newfd)</td></tr>
<tr class="memdesc:ga1bc4122ebd851bb3ecdaf46f34fb2566"><td class="mdescLeft">&#160;</td><td class="mdescRight">Duplicate stream pointer.  <a href="group__stream.html#ga1bc4122ebd851bb3ecdaf46f34fb2566"></a><br/></td></tr>
<tr class="memitem:ga9e29abc7702e850c4fe23dd86fc51139"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga9e29abc7702e850c4fe23dd86fc51139">_sys_dup</a> (int oldfd)</td></tr>
<tr class="memdesc:ga9e29abc7702e850c4fe23dd86fc51139"><td class="mdescLeft">&#160;</td><td class="mdescRight">Duplicate stream pointer.  <a href="group__stream.html#ga9e29abc7702e850c4fe23dd86fc51139"></a><br/></td></tr>
<tr class="memitem:gaa47253a2ed38cacde66dd0c8aabdcd21"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#gaa47253a2ed38cacde66dd0c8aabdcd21">_sys_pipe2</a> (int pipefd[2], int flags)</td></tr>
<tr class="memdesc:gaa47253a2ed38cacde66dd0c8aabdcd21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a pipe.  <a href="group__stream.html#gaa47253a2ed38cacde66dd0c8aabdcd21"></a><br/></td></tr>
<tr class="memitem:ga5f58feff0214b638bff817867024ca19"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga5f58feff0214b638bff817867024ca19">_sys_open</a> (char *path, int flags, <a class="el" href="types_8h.html#a161c505f18322d8ce974064784be272a">mode_t</a> mode)</td></tr>
<tr class="memdesc:ga5f58feff0214b638bff817867024ca19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a file stream.  <a href="group__stream.html#ga5f58feff0214b638bff817867024ca19"></a><br/></td></tr>
<tr class="memitem:ga53ce56639070e380089a734e16f15830"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga53ce56639070e380089a734e16f15830">_sys_close</a> (int fd)</td></tr>
<tr class="memdesc:ga53ce56639070e380089a734e16f15830"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close a stream pointer.  <a href="group__stream.html#ga53ce56639070e380089a734e16f15830"></a><br/></td></tr>
<tr class="memitem:ga700324ff2a13ba0eabe1b0a8dd6acc49"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stream.html#ga700324ff2a13ba0eabe1b0a8dd6acc49">_sys_close_int</a> (<a class="el" href="process_8h.html#aba6f35930ecff1efae67096dfaa95185">process_info_t</a> *process, int fd)</td></tr>
<tr class="memdesc:ga700324ff2a13ba0eabe1b0a8dd6acc49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close a stream pointer on a different process.  <a href="group__stream.html#ga700324ff2a13ba0eabe1b0a8dd6acc49"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Implements the UNIX file API ( fd streams ) </p>
<p>Slightly different terminology is used here:</p>
<p>UNIX - POSNK </p>
<ul>
<li>File description - stream info </li>
<li>File descriptor - stream pointer </li>
<li>File (opened) - stream</li>
</ul>
<p>Part of P-OS kernel.</p>
<dl class="section author"><dt>Author</dt><dd>Peter Bosch <a href="#" onclick="location.href='mai'+'lto:'+'pet'+'er'+'bos'+'c@'+'gma'+'il'+'.co'+'m'; return false;">peter<span style="display: none;">.nosp@m.</span>bosc<span style="display: none;">.nosp@m.</span>@gmai<span style="display: none;">.nosp@m.</span>l.co<span style="display: none;">.nosp@m.</span>m</a></dd></dl>
<p>Changelog:<br/>
 </p>
<ul>
<li>20-04-2014 - Created </li>
</ul>

<p>Definition in file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>
</div><h2>Function Documentation</h2>
<a class="anchor" id="acd4a9d7be01e07112dcec50116bcc482"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _sys_ftruncate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af83497edef361523a95b06deda0b4c2d">off_t</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resize a file. </p>
<p>If the new size is larger than the file currently is the new room will be filled with zero bytes, if the new size is smaller the data in the truncated part of the file is deleted</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file stream to operate on </td></tr>
    <tr><td class="paramname">size</td><td>The new size of the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>In case of error: -1, Otherwise 0</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">EBADF</td><td>fd does not refer to an open stream </td></tr>
    <tr><td class="paramname">EBADF</td><td>fd was not opened with WRITE access mode </td></tr>
    <tr><td class="paramname">EINVAL</td><td>fd does not refer to a file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__vfs.html#ga9913748fc23c6bfe9d775a2f27d82228" title="Resize a file.">vfs_truncate</a> for more errors </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00578">578</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="errno_8h_source.html#l00012">EBADF</a>, <a class="el" href="errno_8h_source.html#l00025">EINVAL</a>, <a class="el" href="streams_8h_source.html#l00103">stream_info::flags</a>, <a class="el" href="streams_8h_source.html#l00083">stream_ptr::info</a>, <a class="el" href="streams_8h_source.html#l00109">stream_info::inode</a>, <a class="el" href="streams_8h_source.html#l00115">stream_info::lock</a>, <a class="el" href="fcntl_8h_source.html#l00037">O_ACCMODE</a>, <a class="el" href="fcntl_8h_source.html#l00023">O_RDONLY</a>, <a class="el" href="synch_8c_source.html#l00029">semaphore_down()</a>, <a class="el" href="synch_8c_source.html#l00023">semaphore_up()</a>, <a class="el" href="streams_8c_source.html#l00052">stream_get_ptr()</a>, <a class="el" href="streams_8h_source.html#l00040">STREAM_TYPE_FILE</a>, <a class="el" href="streams_8h_source.html#l00043">STREAM_TYPE_PIPE</a>, <a class="el" href="syscall__ids_8h_source.html#l00019">syscall_errno</a>, <a class="el" href="streams_8h_source.html#l00097">stream_info::type</a>, and <a class="el" href="vfs_8c_source.html#l01044">vfs_truncate()</a>.</p>

<p>Referenced by <a class="el" href="sc__streams_8c_source.html#l00206">sys_ftruncate()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d55d32570fd809c62d13ab0085f5dca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stream_alloc_fd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a new fd handle. </p>
<dl class="section return"><dt>Returns</dt><dd>A unique new handle </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00187">187</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="errno_8h_source.html#l00027">EMFILE</a>, <a class="el" href="process_8h_source.html#l00093">process_info::fd_ctr</a>, <a class="el" href="scheduler_8c_source.html#l00023">scheduler_current_task</a>, and <a class="el" href="syscall__ids_8h_source.html#l00019">syscall_errno</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l01150">_sys_dup()</a>, <a class="el" href="streams_8c_source.html#l01398">_sys_open()</a>, and <a class="el" href="streams_8c_source.html#l01184">_sys_pipe2()</a>.</p>

</div>
</div>
<a class="anchor" id="a8869ae2b9e5f982d0aecd90bd391fb8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stream_claim_fd </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Claim a fd handle. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The handle to claim </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00203">203</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="process_8h_source.html#l00093">process_info::fd_ctr</a>, and <a class="el" href="scheduler_8c_source.html#l00023">scheduler_current_task</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l01087">_sys_dup2()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f7163659cc3ed18fb77ba36481fd6c5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stream_closeall_iterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterator that will select all closeable stream pointers. </p>
<dl class="section return"><dt>Returns</dt><dd>Whether the stream is closeable </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00164">164</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l00173">stream_do_close_all()</a>.</p>

</div>
</div>
<a class="anchor" id="ab264f86ce9b3c8adb5eb3ec55b4e643d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stream_exec_iterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Linked list iterator that finds stream ptrs that are to be closed on execution of a new image. </p>
<p>Whether or not this is the case is determined by the pointer flag FD_CLOEXEC</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The pointer to test </td></tr>
    <tr><td class="paramname">param</td><td>UNUSED </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether this ptr is to be closed on exec </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00138">138</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="fcntl_8h_source.html#l00039">FD_CLOEXEC</a>, and <a class="el" href="streams_8h_source.html#l00080">stream_ptr::fd_flags</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l00150">stream_do_close_on_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6cba25b02baab322694c3f22c1a6f9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stream_free_fd </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a fd handles. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The handle to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000060">Todo:</a></b></dt><dd>: Implement fd reuse </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00214">214</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l01618">_sys_close_int()</a>, <a class="el" href="streams_8c_source.html#l01150">_sys_dup()</a>, <a class="el" href="streams_8c_source.html#l01398">_sys_open()</a>, and <a class="el" href="streams_8c_source.html#l01184">_sys_pipe2()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d159f64d97eb54699c85af7255727ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__stream.html#ga00b145c81011f4c4048f717a61aa6cc1">stream_ptr_t</a>* stream_get_ptr_o </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="process_8h.html#aba6f35930ecff1efae67096dfaa95185">process_info_t</a> *&#160;</td>
          <td class="paramname"><em>process</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the stream pointer object for a file number on a different process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">process</td><td>The process context to use when looking up the stream pointer </td></tr>
    <tr><td class="paramname">fd</td><td>The open file number to look up </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The stream pointer or NULL if fd is invalid </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00066">66</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="process_8h_source.html#l00092">process_info::fd_table</a>, <a class="el" href="llist_8c_source.html#l00141">llist_iterate_select()</a>, and <a class="el" href="streams_8c_source.html#l00040">stream_ptr_search_iterator()</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l01618">_sys_close_int()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3106e5fbaa22fcc1be4d34082210937"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stream_ptr_copy_iterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Linked list iterator that copies a process's open fds. </p>
<p>This iterator will create a new stream pointer for each fd it is called on that refers to the same stream info </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The linked list node we are called on (must be a stream_ptr_t *) </td></tr>
    <tr><td class="paramname">param</td><td>The parameter for this iterator (must be a llist_t *head) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether to select this item, will always be 0 incase of success </dd></dl>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00082">82</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="streams_8h_source.html#l00080">stream_ptr::fd_flags</a>, <a class="el" href="heapmm_8c_source.html#l00552">heapmm_alloc()</a>, <a class="el" href="streams_8h_source.html#l00074">stream_ptr::id</a>, <a class="el" href="streams_8h_source.html#l00083">stream_ptr::info</a>, <a class="el" href="llist_8c_source.html#l00078">llist_add_end()</a>, and <a class="el" href="streams_8h_source.html#l00100">stream_info::ref_count</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l00121">stream_copy_fd_table()</a>.</p>

</div>
</div>
<a class="anchor" id="aeeee7624410f1f022ad880a74489c6b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stream_ptr_search_iterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="llist_8h.html#af16880c584a87d791e9296153cf56bbc">llist_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterator to test if stream pointer matches the fd. </p>

<p>Definition at line <a class="el" href="streams_8c_source.html#l00040">40</a> of file <a class="el" href="streams_8c_source.html">streams.c</a>.</p>

<p>References <a class="el" href="streams_8h_source.html#l00074">stream_ptr::id</a>.</p>

<p>Referenced by <a class="el" href="streams_8c_source.html#l00052">stream_get_ptr()</a>, and <a class="el" href="streams_8c_source.html#l00066">stream_get_ptr_o()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_456af83f63a9d8b27e10dd059fe0d1e0.html">kernel</a></li><li class="navelem"><a class="el" href="streams_8c.html">streams.c</a></li>
    <li class="footer">Generated on Mon Jul 14 2014 05:57:11 for posnk kernel by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
